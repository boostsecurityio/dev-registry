api_version: 1.0


id: boostsecurityio/bundler-audit
name: bundler-audit
namespace: boostsecurityio/bundler-audit
scan_types:
  - sca


config:
  support_diff_scan: true
  include_files:
    - Gemfile
    - ${GEMFILE_LOCK:-Gemfile.lock}

steps:
  - scan:
      command:
        docker:
          image: registry.gitlab.com/boostsecurityio/registry/ruby:3.1.2@sha256:a10fa0b3c38af7197acf73e958194e5f86d7080182371b63234080a9ac1e8bc2
          command: |
            bash -c 'touch Gemfile &&
                     gem install --silent bundler-audit -v "0.9.1" &&
                     (bundler-audit check --gemfile-lock="$GEMFILE_LOCK" --quiet --update --format json . || true)'
          workdir: /src
          environment:
            HOME: /tmp
            GEMFILE_LOCK: ${GEMFILE_LOCK:-Gemfile.lock}
      format: sarif
      post-processor:
        docker:
            image: public.ecr.aws/boostsecurityio/boost-scanner-bundler-audit:3f3dff5@sha256:323cb2190e259fb961f30a3303e7bde385b69124819d5f557c424ff21524c777
            command: process
            environment:
                GEMFILE_LOCK: ${GEMFILE_LOCK:-Gemfile.lock}
                PYTHONIOENCODING: utf-8
