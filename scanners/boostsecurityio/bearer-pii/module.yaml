api_version: 1.0

id: boostsecurityio/bearer-pii
name: BoostSecurity Bearer (PII)
namespace: boostsecurityio/bearer-pii
scan_types:
  - metadata

config:
  support_diff_scan: false
  require_full_repo: true

setup:
- name: Download Bearer module
  run: |
  environment:
    VERSION: 1.16.0
    LINUX_X86_64_SHA: 8fdb6cd20638bfcf6c7b700a14cac2567d892fc8eb7b83a8e20afb6ff85194f2
    MACOS_AMD64_SHA: 942bb5751e61c27addb9a2b777a3744cff9e2e38524312b5e79009ef028ab1d9
    MACOS_ARM64_SHA: 72e7293b7f0593d9afd2e74417c9872bd7ec126d59c4f7126212e50342dc20b1
  run: |
    BINARY_URL="https://github.com/Bearer/bearer/releases/download/v${VERSION}"
    case "$(uname -sm)" in
      "Linux x86_64")
        BINARY_URL="${BINARY_URL}/bearer_${VERSION}_linux_amd64.tar.gz"
        SHA="${LINUX_X86_64_SHA} bearer.tar.gz"
        ;;
      "Darwin x86_64")
        BINARY_URL="${BINARY_URL}/bearer_${VERSION}_darwin_amd64.tar.gz"
        SHA="${MACOS_AMD64_SHA} bearer.tar.gz"
        ;;
      "Darwin arm64")
        BINARY_URL="${BINARY_URL}/bearer_${VERSION}_darwin_arm64.tar.gz"
        SHA="${MACOS_ARM64_SHA} bearer.tar.gz"
        ;;
      *)
        echo "Unsupported machine: ${OPTARG}"
        exit 1
        ;;
    esac
    
    curl -o bearer.tar.gz -fsSL "${BINARY_URL}"
    echo "${SHA}" | sha256sum --check
    
    tar -zxvf bearer.tar.gz bearer
    rm bearer.tar.gz
    
    chmod +x bearer
steps:
- scan:
    command:
      run: |
        $SETUP_PATH/bearer scan --format json --report=privacy .
    format: metadata
    post-processor:
      docker:
        image: public.ecr.aws/boostsecurityio/boost-scanner-bearer:fc69f64@sha256:bc2df1892c6fc13afc81e66c75e86a36835dd6b85282cdb9dabc12bbeca0f05a
        command: privacy -
