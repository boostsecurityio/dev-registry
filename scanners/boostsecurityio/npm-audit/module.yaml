api_version: 1.0


id: boostsecurityio/npm-audit
name: npm-audit
namespace: boostsecurityio/npm-audit
scan_types:
  - sca

config:
  support_diff_scan: true
  include_files:
    - package-lock.json

setup:
  - name: Utility scripts
    run: |
      mkdir -p $SETUP_PATH/pre-scan-checks/
      cp $SETUP_PATH/../../registry/scanners/boostsecurityio/npm-audit/prescan_checks.sh $SETUP_PATH/pre-scan-checks/npm-audit

steps:
  - run: $SETUP_PATH/pre-scan-checks/npm-audit
  - scan:
      command:
        docker:
          image: node:22-alpine3.21@sha256:ad1aedbcc1b0575074a91ac146d6956476c1f9985994810e4ee02efd932a68fd
          command: |
            sh -c 'npm audit --json $NPM_AUDIT_ARGS || true'
          workdir: /src
          environment:
            HOME: /tmp
            NPM_AUDIT_ARGS: ${NPM_AUDIT_ARGS:-}
      format: sarif
      post-processor:
        docker:
            image: public.ecr.aws/boostsecurityio/boost-converter-sca:eeb51da@sha256:d407b67666b200602c5900c62330f82a565cd80757315b362df1ec9976c0f8ac
            command: |
              process --scanner npm-audit
            environment:
                PYTHONIOENCODING: utf-8
