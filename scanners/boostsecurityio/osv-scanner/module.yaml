api_version: 1.0


id: boostsecurityio/osv-scanner
name: BoostSecurity osv-scanner
namespace: boostsecurityio/osv-scanner
scan_types:
  - sca


config:
  support_diff_scan: true
  include_files:
    - buildscript-gradle.lockfile
    - Cargo.lock
    - composer.lock
    - conan.lock
    - Gemfile.lock
    - go.mod
    - gradle.lockfile
    - mix.lock
    - package-lock.json
    - packages.lock.json
    - pdm.lock
    - Pipfile.lock
    - pnpm-lock.yaml
    - poetry.lock
    - pom.xml
    - pubspec.lock
    - requirements.txt
    - renv.lock
    - yarn.lock

setup:
  - name: Get Values
    run: |
      echo "Boost Scan Path: ${BOOST_SCAN_PATH}"
      echo "Boost EXec Path: ${BOOST_SCAN_CMD_EXEC_PATH}"

steps:
- scan:
    command:
      docker:
        image: public.ecr.aws/boostsecurityio/boost-scanner-osv:eb33e00@sha256:9781255c0c6af6f45bd117b44f6b73368fbf73a961e1287b461552aa40412afb
        command: |
           -c 'osv-scanner scan --recursive --call-analysis=all --format json . 2> /dev/null; exit_code=$?; if [ $exit_code -gt 126 ]; then exit $exit_code; fi'
        workdir: /project
    format: sarif
    post-processor:
      run: |
        if [ -z "$BOOST_SCAN_PATH" ]; then
          export BOOST_SCAN_CMD_EXEC_PATH="/project"
        else
          export BOOST_SCAN_CMD_EXEC_PATH="/project/${BOOST_SCAN_PATH}"
        fi
        export PYTHONIOENCODING="utf-8"
        docker run -i public.ecr.aws/boostsecurityio/boost-converter-sca:0fa5bd7@sha256:2175fb91a33d9a254b3bc6f7f5f330773bc43f5e9e044be8c4456ebc14526639 'process --scanner osv'
#      docker:
#          image: public.ecr.aws/boostsecurityio/boost-converter-sca:0fa5bd7@sha256:2175fb91a33d9a254b3bc6f7f5f330773bc43f5e9e044be8c4456ebc14526639
#          command: process --scanner osv
#          environment:
#              PYTHONIOENCODING: utf-8
              # Need to set the BOOST_SCAN_CMD_EXEC_PATH env variable since the osv-scanner docker image
              # doesn't deal with the absolute paths.
#              BOOST_SCAN_CMD_EXEC_PATH: /project
